var _			= require("underscore");
var needle		= require('needle');

var stocktwits_client = function(options) {
	
	this.options = _.extend({
		perms:				"read,watch_lists,publish_messages,publish_watch_lists,direct_messages,follow_users,follow_stocks",
		base:				"https://api.stocktwits.com/api/2/",
		useragent:			"NodeJS stocktwits_client client",
		consummerKey:		"fad12fc04b67ab4e",
		consummerSecret:	"cd799378d7450314be2ed8ddc3868dfaed0178ef",
		access_token:		false
	}, options);
	
	this.init();
};

stocktwits_client.prototype.init = function() {
	
};

stocktwits_client.prototype.getAccessToken = function(code, callback) {
	needle.post("https://api.stocktwits.com/api/2/oauth/token", {
		client_id:		this.options.consummerKey,
		client_secret:	this.options.consummerSecret,
		code:			code,
		grant_type:		"authorization_code",
		redirect_uri:	"http://localhost/git/AIStock/build/auth.html"
	}, function(err, response) {
		callback(response);
	});
};

stocktwits_client.prototype.getTrendingSymbols = function(access_token, callback) {
	needle.get("https://api.stocktwits.com/api/2/trending/symbols.json?access_token="+escape(access_token), function(err, response) {
		callback(response);
	});
};

exports.main = stocktwits_client;